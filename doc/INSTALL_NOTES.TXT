This is the installation guide for the SCEC Broadband Platform.

=================================================================
INSTALLING THE SCEC BROADBAND PLATFORM
=================================================================

Installing the Broadband Platform involves obtaining a copy of the
code and building the required executables.  You can download the
platform from the Broadband web site:

<http://www.scec.org/research/broadband>

----------------------------------------------------------------
1. Dependencies
----------------------------------------------------------------

The Broadband Platform has the following dependencies:

	Python 2.7.9+ with:
		Matplotlib - 1.4.3
		Numpy - 1.9.2
		Scipy - 0.14.1
		Pyproj - 1.9.2

	GNU compilers:
		gfortran - 4.5.1
		gcc - 4.5.1

----------------------------------------------------------------
2. Easy Installation
----------------------------------------------------------------

Starting with this version of the Broadband Platform, we provide an
easy installation script that can guide users through downloading and
installing the Broadband Platform on a Linux or Mac OS X computer that
meets the system requirements for the Broadband Platform.

To use this method, users should first download the easy installation
script from the Broadband Platform website. Then users can start the
installation with:

$ chmod +x easy_install_bbp_16.5.0.sh
$ ./easy_install_bbp_16.5.0.sh <directory>

The script will automatically create a "bbp" subdirectory, where it
will install the Broadband Platform. To install the Broadband Platform
in the current directory, users can simply type:

$ ./easy_install_bbp_16.5.0.sh .

 ====== Welcome to Broadband Platform 16.5.0 installation script =====

 Using destination directory: /home/sarah

 => Main Broadband Platform Source Distribution
 ==> Downloading...
 ==> Compiling...
 ==> Installed!

The easy installation script will automatically download and compile
the main source distribution. Following that, it will ask users to
select which regions should be installed along with the
Platform. Please note that saying "Yes" to a region, will
automatically install any validation events available for that
region. At a minimum, and in order to run Unit and Acceptance tests,
users should say "Yes" to the "LA Basin" region.

 Please select what velocity models (regions) you would like to install:

 ==> Would you like to install the Northern California region?
 1) Yes
 2) No
 #?2

 ==> Would you like to install the LA Basin region?
 1) Yes
 2) No
 #? 1

 ...
 ...
 ...

 => Installing Broadband Platform Velocity Model Packages
 ==> LA Basin
 ==> Completed!
 => Installing Broadband Platform Validation Packages
 ==> Northridge
 ==> GMPEs
 ==> Completed!

 => All Done!

At the end of the installation, the script will print instructions
for the user to add several lines to their .bash_profile file.

 Please add the following lines to your .bash_profile:

 export BBP_DIR=/home/sarah/bbp/16.5.0/bbp
 export BBP_GF_DIR=/home/sarah/bbp/bbp_gf
 export BBP_VAL_DIR=/home/sarah/bbp/bbp_val
 export PYTHONPATH=/home/sarah/bbp/16.5.0/bbp/comps
 export BBP_DATA_DIR=/home/sarah/bbp/bbp_data
 export PATH=/home/sarah/bbp/16.5.0/bbp/comps:/home/sarah/bbp/16.5.0/bbp/utils/batch:$PATH

After installing the Broadband Platform on their systems, users should
confirm the code is built correctly by running Unit and Acceptance
tests before using the Broadband Platform for research
purposes. Please refer to section 6 below for more details.

----------------------------------------------------------------
3. Manual Installation - Downloading the Platform
----------------------------------------------------------------

Download the main Broadband distribution file from the Broadband
website. Users should also download the Greens' Functions files for
the regions where simulations will be performed. Currently the
platform supports the following regions:

* LABasin (this package is required to run the Unit and Acceptance tests)
* Mojave
* NoCal
* Western Japan
* Central Japan
* Eastern United States
* Eastern Canada

Additionally, users can optionally download validation packages for
the following recorded events:

* Northridge (requires the LABasin GF package)
* Loma Prieta (requires the Loma Prieta GF package)

Please note that the Northridge validation package is required for
running the acceptance tests described in the section below. After
downloading the needed files to your local Linux or Mac OS X computer,
users can calculate their checksums and compare them to the checksums
on the Broadband web site to verify that you have the correct
files. For Linux, you can use the command:

$ md5sum downloaded_file.tar.gz

where "downloaded_file.tar.gz" is the file downloaded from the
Broadband website. Users should do this once for each of the
downloaded files to make sure they have successfully downloaded the
files. For Mac OS X computer, use the md5 command instead.

---------------------------------------------------------------
4. Manual Installation - Platform Directory Structure Setup
---------------------------------------------------------------

After confirming that all downloaded files are good, it is time to set
up the directory structure used by the Broadband Platform. Start by
creating a top-level directory for the Broadband Platform
installation. In our example, we will use 'bbp' as this top-level
directory. Assuming this directory will be installed in for the user
"sarah":

$ cd /home/sarah
$ mkdir bbp
$ cd bbp

Now, untar the main Broadband distribution file (assuming all
downloaded files are located in /home/sarah/downloads):

$ tar -xzvf /home/sarah/downloads/bbp-dist-16.5.0.tar.gz

This will create the "16.5.0" directory with the main distribution
content. Now, create 2 more directories: one for the downloaded
Greens' Functions and another for the optional Validation packages:

$ mkdir bbp_gf
$ mkdir bbp_val

Go into the bbp_gf directory and untar each of the downloaded GF
packages:

$ cd bbp_gf

For the LABasin package, the command would be:

$ tar -xzvf /home/sarah/downloads/labasin-velocity-model-16.5.0.tar.gz

Please untar any other GF packages that you desire to install.

Now, we need to do the same thing for the validation packages. Switch
to the bbp_val directory and install any validation packages that were
downloaded. For example, to install the Northridge validation package,
users will need to:

$ cd /home/sarah/bbp/bbp_val
$ tar -xzvf /home/sarah/downloads/northridge-validation-16.5.0.tar.gz

We are almost ready now. Users will need to create another directory,
which will contain all the simulations that will be generated by the
Broadband Platform. In this example, we will use "bbp_data", and will
place it along with the other directories that we created above, using
the commands:

$ cd /home/sarah/bbp
$ mkdir bbp_data

The last step before we can proceed is to set up environment variables
indicating where each of the above directories are located so that the
Broadband Platform can find their locations. Using the example above,
users will need to set up the following 6 environment variables:

If using BASH, add the following lines to your .bash_profile file:

export BBP_DIR=/home/sarah/bbp/16.5.0/bbp
export BBP_GF_DIR=/home/sarah/bbp/bbp_gf
export BBP_VAL_DIR=/home/sarah/bbp/bbp_val
export BBP_DATA_DIR=/home/sarah/bbp/bbp_data
export PYTHONPATH=$BBP_DIR/comps:$PYTHONPATH
export PATH=$BBP_DIR/comps:$BBP_DIR/utils/batch:$PATH

If using a C-shell, add the following to your .cshrc:

setenv BBP_DIR /home/sarah/bbp/16.5.0/bbp
setenv BBP_GF_DIR /home/sarah/bbp/bbp_gf
setenv BBP_VAL_DIR /home/sarah/bbp/bbp_val
setenv BBP_DATA_DIR /home/sarah/bbp/bbp_data
setenv PYTHONPATH ${BBP_DIR}/comps:${PYTHONPATH}
setenv PATH ${BBP_DIR}/comps:${BBP_DIR}/utils/batch:${PATH}

Note that users may need to log out and log in again in order for this
change to take effect.

---------------------------------------------------------------
5. Manual Installation - Building the Platform
---------------------------------------------------------------

Once users have downloaded and untar'ed the code and supporting
packages, the final step is to compile the Broadband Platform. Using
the example provided in the section above, users will need to go to
the 'src' directory and compile the code. Before trying to compile the
code, users can use the following command to make sure the needed
compilers are present in their path:

$ which gcc

If you get a message like "no gcc in path" you will need to add the
GNU compilers to your path. Once that is done, you can compile the
code using the following commands:

$ cd /home/sarah/bbp/16.5.0/bbp/src
$ make clean
$ make

This will take a few minutes, and once it is done, you are ready to
start using the Broadband Platform!

---------------------------------------------------------------
6. Running Unit and Acceptance Tests
---------------------------------------------------------------

In order to make sure the Broadband platform is installed properly,
users are encouraged to run the Unit and Acceptance tests provided
with the Platform. These tests require the LABasin Greens' Functions
package to be installed. Acceptance tests will also require the
Northridge validation package. Unit tests will verify the correct
output of individual scientific codes (e.g. the rupture generator),
while acceptance tests will run a complete broadband simulation from
beginning to end with a small list of stations in order to make sure
the entire software pipeline is working properly.

In order to run the unit tests, users should go to the tests directory
and type:

$ cd /home/sarah/bbp/16.5.0/bbp/tests
$ ./UnitTests.py

The tests should begin and will take between 30 and 60 minutes to
run. At the end of each test, a "ok" should be printed if the test was
successful. At the end, the program will print the number of tests
that passed.

To run the acceptance tests, users should:

$ cd /home/sarah/bbp/16.5.0/bbp/tests
$ ./AcceptTests.py

There will be one test for each method in the platform, for both the
validation mode (historical events) and the scenario modes
(hypotethical earthquakes). These tests will take somewhere between 2
and 3 hours to run, depending on how fast the computer is.

